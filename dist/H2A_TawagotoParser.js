!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e),i.d(e,"default",(function(){return l}));const s={WINDOW:0,BLACK:1,NONE:2},n={CASE_1:0,CASE_2:1,CASE_3:2,CASE_4:3,CASE_5:4,CASE_6:5},r={FACE:{EMPTY:["",0]},MODE:s,POS:{TOP:0,CENTER:1,BOTTOM:2}},o={WIN:s,POS:{LEFT:0,CENTER:1,RIGHT:2},INIT:Object.assign({NONE:-1},n),ESC:Object.assign({OK:-2,NG:-1},n)},E={VOL:{MIN:0,MUTE:0,HALF:50,MAX:100},PITCH:{SLOW:50,DEFAULT:100,FAST:150},PAN:{LEFT:-100,CENTER:0,RIGHT:100}},c={POINT:{CORNER:0,CENTER:1},POS:{ZERO:[0,0]},POSMODE:{VALUE:0,VARIABLE:1},SCALE:{ZERO:[0,0],DEFAULT:[100,100]},ALFA:{HIDE:0,HALF:127,VISIBLE:255},MIXMODE:{DEFAULT:0,ADD:1,SUB:2,SCREEN:3}},a={EMPTY:0,SCRIPT_BEGIN:355,SCRIPT:655,PLAY_BGM:241,PLAY_BGS:245,PLAY_ME:249,PLAY_SE:250,MESSAGE_INIT:101,MESSAGE:401,CHOICE_INIT:102,CHOICE_CASE:402,CHOICE_ESC:403,CHOICE_END:404,LABEL:118,LABEL_JUMP:119,WAIT:230,GOTO_MENU:351,GOTO_SAVE:352,GOTO_GAMEOVER:353,GOTO_TITLE:354,SCREEN_COLOR:223},O={window:{face:r.FACE.EMPTY,mode:r.MODE.WINDOW,pos:r.POS.BOTTOM},choice:{win:o.WIN.WINDOW,pos:o.POS.RIGHT,init:o.INIT.NONE,esc:o.ESC.NG},audio:{vol:E.VOL.MAX,pitch:E.PITCH.DEFAULT,pan:E.PAN.CENTER},picture:{point:c.POINT.CORNER,pos:c.POS.ZERO,posMode:c.POSMODE.VALUE,scale:c.SCALE.DEFAULT,alfa:c.ALFA.VISIBLE,mixMode:c.MIXMODE.DEFAULT}},u=(t,e)=>t instanceof Array&&t.length===e,A=(t,e,i=0)=>({code:t,parameters:e,indent:i});class l{constructor(t,e){const{window:i,choice:s,audio:n,picture:r}=t||{};this.state={window:Object.assign(Object.assign({},O.window),i||{}),choice:Object.assign(Object.assign({},O.choice),s||{}),audio:Object.assign(Object.assign({},O.audio),n||{}),picture:Object.assign(Object.assign({},O.picture),r||{})},this.list=e||[]}messageToArray(t){if((e=t)instanceof Array&&!e.map(t=>"string"==typeof t).includes(!1))return t;var e;if("string"!=typeof t)throw new TypeError("メッセージの型が不正です。");const i=t.split("\n");if(1===i.length)return[i[0]];const s=i.map(t=>t.trim()),[n,...r]=s;return""===n?r:s}getList(){return[...this.list,A(a.EMPTY,[])]}exec(){window.$gameMap._interpreter._list=this.list}setWindow(t){this.state.window=Object.assign(Object.assign({},this.state.window),t)}setChoice(t){this.state.choice=Object.assign(Object.assign({},this.state.choice),t)}setAudio(t){this.state.audio=Object.assign(Object.assign({},this.state.audio),t)}setPicture(t){this.state.picture=Object.assign(Object.assign({},this.state.picture),t)}js(t){const[e,...i]=this.messageToArray(t),s=[A(a.SCRIPT_BEGIN,[e]),...i.map(t=>A(a.SCRIPT,[t]))];return this.list=[...this.list,...s],s}playAudio(t,e){const{vol:i,pitch:s,pan:n}=this.state.audio,r=[A(t,[{name:e,volume:i,pitch:s,pan:n}])];return this.list=[...this.list,...r],r}bgm(t){return this.playAudio(a.PLAY_BGM,t)}bgs(t){return this.playAudio(a.PLAY_BGS,t)}me(t){return this.playAudio(a.PLAY_ME,t)}se(t){return this.playAudio(a.PLAY_SE,t)}mes(t){const{face:e,mode:i,pos:s}=this.state.window;if(!u(e,2))throw new TypeError("顔グラフィック設定が不正です。");const n=this.messageToArray(t),r=[A(a.MESSAGE_INIT,[...e,i,s]),...n.map(t=>A(a.MESSAGE,[t]))];return this.list=[...this.list,...r],r}choice(t,e,i){const{win:s,pos:n,init:r,esc:o}=this.state.choice,E=[A(a.CHOICE_INIT,[e.map(t=>t.label),o,r,n,s]),...e.reduce((e,{label:i},s)=>[...e,A(a.CHOICE_CASE,[s,i]),A(a.LABEL_JUMP,[`${t}_${s}`],1),A(a.EMPTY,[],1)],[]),...void 0!==i?[A(a.CHOICE_ESC,[6,null]),A(a.LABEL_JUMP,[t+"_ESC"],1),A(a.EMPTY,[],1)]:[],A(a.CHOICE_END,[]),...e.reduce((e,{code:i},s)=>[...e,A(a.LABEL,[`${t}_${s}`]),...i(new l).reduce((t,e)=>[...t,...e],[]),A(a.LABEL_JUMP,[t+"_END"])],[]),...void 0!==i?[A(a.LABEL,[t+"_ESC"]),...i(new l).reduce((t,e)=>[...t,...e],[]),A(a.LABEL_JUMP,[t+"_END"])]:[],A(a.LABEL,[t+"_END"])];return this.list=[...this.list,...E],E}label(t){const e=[A(a.LABEL,[t])];return this.list=[...this.list,...e],e}goto(t){const e=[A(a.LABEL_JUMP,[t])];return this.list=[...this.list,...e],e}wait(t){const e=[A(a.WAIT,[t])];return this.list=[...this.list,...e],e}gotoMenu(){const t=[A(a.GOTO_MENU,[])];return this.list=[...this.list,...t],t}gotoSave(){const t=[A(a.GOTO_SAVE,[])];return this.list=[...this.list,...t],t}gotoGameOver(){const t=[A(a.GOTO_GAMEOVER,[])];return this.list=[...this.list,...t],t}gotoTitle(){const t=[A(a.GOTO_TITLE,[])];return this.list=[...this.list,...t],t}changeScreenColor(t,e,i,s=!1){if(!u(t,3))throw new TypeError("色指定が不正です。");const n=[A(a.SCREEN_COLOR,[[...t,e],i,!s])];return this.list=[...this.list,...n],n}}l.WINDOW=r,l.CHOICE=o,l.AUDIO=E,l.PICTURE=c,l.COLOR={BLACK:[0,0,0],RED:[255,0,0],GREEN:[0,255,0],BLUE:[0,0,255],YELLOW:[255,255,0],CYAN:[0,255,255],MAGENTA:[255,0,255],WHITE:[255,255,255]},l.INTERPRETER=a,window.TawagotoScript=l}]);